name: Update Sports News Feeds

on:
  schedule:
    - cron: "0 */6 * * *"   # –Ω–∞ –≤—Å–µ–∫–∏ 6 —á–∞—Å–∞
  workflow_dispatch:

permissions:
  contents: write   # üî¥ –ó–ê–î–™–õ–ñ–ò–¢–ï–õ–ù–û –∑–∞ git push

jobs:
  update-feeds:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Checkout repo
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Setup Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.x"

      # 3Ô∏è‚É£ Install dependencies
      - name: Install Python dependencies
        run: |
          pip install feedparser

      # 4Ô∏è‚É£ Generate sports news feed JSON
      - name: Update sports news feeds
        run: |
          python << 'EOF'
          import json
          import feedparser
          from datetime import datetime
          import os

          FEEDS = {
              "NFL": "https://www.espn.com/espn/rss/nfl/news",
              "NBA": "https://www.espn.com/espn/rss/nba/news",
              "MLB": "https://www.espn.com/espn/rss/mlb/news",
              "NHL": "https://www.espn.com/espn/rss/nhl/news"
          }

          os.makedirs("feeds", exist_ok=True)

          output = {}

          for sport, url in FEEDS.items():
              feed = feedparser.parse(url)
              output[sport] = []

              for entry in feed.entries[:5]:
                  output[sport].append({
                      "title": entry.title,
                      "link": entry.link,
                      "published": entry.get("published", ""),
                      "source": "ESPN"
                  })

          output["updated"] = datetime.utcnow().isoformat() + "Z"

          with open("feeds/sports-news.json", "w", encoding="utf-8") as f:
              json.dump(output, f, indent=2, ensure_ascii=False)

          print("‚úÖ Sports news feed updated")
          EOF

      # 5Ô∏è‚É£ Commit & push if changed
      - name: Commit and push changes
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

          git add feeds/sports-news.json
          git diff --cached --quiet || git commit -m "Auto-update sports news feeds"
          git push

name: Update Sports News Feed

on:
  schedule:
    - cron: "0 */6 * * *"   # на всеки 6 часа
  workflow_dispatch:

jobs:
  update-news:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Fetch and generate sports news
        run: |
          python << 'EOF'
          import json
          import feedparser
          from datetime import datetime

          feeds = {
              "NFL": "https://www.espn.com/espn/rss/nfl/news",
              "NBA": "https://www.espn.com/espn/rss/nba/news"
          }

          output = {"NFL": [], "NBA": []}

          for sport, url in feeds.items():
              feed = feedparser.parse(url)
              for entry in feed.entries[:5]:
                  output[sport].append({
                      "title": entry.title,
                      "link": entry.link,
                      "published": entry.get("published", ""),
                      "source": "ESPN"
                  })

          output["updated"] = datetime.utcnow().isoformat() + "Z"

          with open("feeds/sports-news.json", "w") as f:
              json.dump(output, f, indent=2)
          EOF

      - name: Commit and push changes
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add feeds/sports-news.json
          git commit -m "Auto-update sports news feed" || echo "No changes"
          git push

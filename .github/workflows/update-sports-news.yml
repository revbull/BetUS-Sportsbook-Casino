- name: Update sports news feeds
  run: |
    python << 'EOF'
    import json
    import feedparser
    from datetime import datetime
    import os

    FEEDS = {
        "NFL": [
            ("ESPN", "https://www.espn.com/espn/rss/nfl/news"),
            ("CBS", "https://www.cbssports.com/rss/headlines/nfl/"),
            ("Yahoo", "https://sports.yahoo.com/nfl/rss.xml")
        ],
        "NBA": [
            ("ESPN", "https://www.espn.com/espn/rss/nba/news"),
            ("CBS", "https://www.cbssports.com/rss/headlines/nba/"),
            ("Yahoo", "https://sports.yahoo.com/nba/rss.xml")
        ],
        "MLB": [
            ("ESPN", "https://www.espn.com/espn/rss/mlb/news"),
            ("CBS", "https://www.cbssports.com/rss/headlines/mlb/"),
            ("Yahoo", "https://sports.yahoo.com/mlb/rss.xml")
        ],
        "NHL": [
            ("ESPN", "https://www.espn.com/espn/rss/nhl/news"),
            ("CBS", "https://www.cbssports.com/rss/headlines/nhl/"),
            ("Yahoo", "https://sports.yahoo.com/nhl/rss.xml")
        ]
    }

    os.makedirs("feeds", exist_ok=True)

    output = {}

    for sport, sources in FEEDS.items():
        items = []

        for source_name, url in sources:
            feed = feedparser.parse(url)

            for entry in feed.entries[:4]:
                items.append({
                    "title": entry.get("title", "").strip(),
                    "link": entry.get("link", ""),
                    "published": entry.get("published", ""),
                    "source": source_name
                })

        # Deduplicate by title
        seen = set()
        deduped = []
        for item in items:
            if item["title"] and item["title"] not in seen:
                seen.add(item["title"])
                deduped.append(item)

        output[sport] = deduped[:6]

    output["updated"] = datetime.utcnow().isoformat() + "Z"

    with open("feeds/sports-news.json", "w", encoding="utf-8") as f:
        json.dump(output, f, indent=2, ensure_ascii=False)

    print("âœ… Multi-source sports news feed updated")
    EOF
